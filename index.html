<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cat on the wall</title>
    <script src="https://zimjs.org/cdn/1.4.1/createjs.js"></script>
    <script src="https://zimjs.org/cdn/016/zim_min.js"></script>
    <script src="https://zimjs.org/cdn/2.1.3/box2d.js"></script>
    <script src="https://zimjs.org/cdn/physics_2.2.js"></script>
    <!-- zimjs.com - JavaScript Canvas Framework -->
    <script type="module">
      // import zim from "https://zimjs.org/cdn/016/zim_physics";

      // See Docs under Frame for FIT, FILL, FULL, and TAG
      const assets = [
        "wall.json",
        "wall.png",
        "cat1.png",
        "cat2.png",
        "menu.png",
        "angyMeow.wav",
        "bg.png",
        "title.png",
        "RandomThought.ttf",
      ];
      const path = "assets/";
      new Frame({
        scaling: FIT,
        width: 720,
        height: 1280,
        color: interstellar,
        outerColor: dark,
        ready: ready,
        sensors: true,
        assets,
        path,
      });

      function ready() {
        let level = 0;
        const forces = [20, 30, 40];
        start();
        function start() {
          const gameContainer = new Container(720, 1280).center();
          const bg = new Pic("bg.png").sca(0.4).center(gameContainer);

          const title = new Pic("title.png")
            .sca(0.2)
            .pos(0, 50, CENTER, TOP, gameContainer);

          const wallAnimate = new Sprite({ json: "wall.json" })
            .sca(0.8)
            .pos(0, 100, CENTER, BOTTOM, gameContainer)
            .run(6);

          const instructions = new Label({
            text: "TiLt To BaLaNcE",
            size: 36,
            font: "RandomThought",
            color: "black",
          }).pos(40, 450, CENTER, TOP, gameContainer);

          const introAnim1 = new Pic("introanim1.png")
            .sca(0.3)
            .reg(CENTER)
            .pos(-150, 410, CENTER, TOP, gameContainer)
            .animate({
              props: { rotation: -10 },
              loop: true,
              time: 0.9,
              ease: "bounceOut",
            });

          const startButton = new Pic("startButton.png")
            .sca(0.2)
            .center(gameContainer)
            .tap(() => {
              startButton.removeFrom();
              wallAnimate.removeFrom();
              instructions.removeFrom();
              introAnim1.removeFrom();
              title.removeFrom();

              const cat1 = new Pic("cat1.png")
                .sca(0.9)
                .reg(CENTER)
                .pos(0, 650, CENTER, BOTTOM, gameContainer)
                .addPhysics({
                  bounciness: 0,
                  angular: 1,
                  density: 1.5,
                });

              new Rectangle(30, 465, red, black, 2)
                .reg(CENTER)
                .pos(0, -10, CENTER, BOTTOM, gameContainer)
                .addPhysics(false);

              const list = new List({
                width: 200,
                height: 200,
                list: {
                  menu: {
                    id0: {
                      obj: new Tile({
                        obj: [
                          new Pic("menu.png").sca(0.4),
                          new Label({
                            text: "Levels  ",
                            size: 36,
                            font: "RandomThought",
                            color: black,
                          }),
                        ],
                        cols: 2,
                        rows: 1,
                        spacingH: 2,
                        spacingV: 0,
                        unique: true,
                        valign: CENTER,
                        backdropColor: white,
                        backdropPaddingv: 40,
                        backdropPaddingH: 30,
                      }),
                      list: {
                        id1: { obj: "Easy" },
                        id2: { obj: "Medium" },
                        id3: { obj: "Hard" },
                      },
                    },
                  },
                  bloom: true,
                  whither: true,
                },
                align: LEFT,
                backgroundColor: yellow,
                rollBackgroundColor: orange,
                pulldown: true,
                pulldownToggle: true,
              })
                .pos(0, 60, LEFT, TOP, gameContainer)
                .change(() => {
                  zog(list.selectedIndex);
                });

              const label = new Label().center(gameContainer);
              F.on("deviceorientation", (e) => {
                label.text =
                  decimals(e.rotation.x) +
                  "," +
                  decimals(e.rotation.y) +
                  "," +
                  decimals(e.rotation.z);

                const forceX = e.rotation.y * forces[level];
                const forceY = e.rotation.x * forces[level];

                cat1.force(forceX, forceY);

                cat1.contact((obj) => {
                  if (obj.type == "Border") {
                    new Aud("angyMeow.wav").play();
                    cat1.dispose();
                  }
                });

                S.update();
              });
            });
        }
      } // end ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
